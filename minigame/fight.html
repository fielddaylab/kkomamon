<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name = "viewport" content = "width = device-width">
<title>Kkomamon Fight</title>
<script type = "text/javascript" src = "arisjs.js"></script>
    
<script type = "text/javascript">
  document.addEventListener('touchmove', function(e) {e.preventDefault();}, false);

  function loadMe()
  {
    setScene(sceneFight);
    initialize();
  }

  function setScene(scene)
  {
    document.getElementById("loading").style.display="none";
    document.getElementById("fight").style.display="none";
    document.getElementById("win").style.display="none";
    document.getElementById("lose").style.display="none";

    if(scene == 0)
      document.getElementById("loading").style.display="block";
    else if(scene == 1)
      document.getElementById("fight").style.display="block";
    else if(scene == 2)
      document.getElementById("win").style.display="block";
    else if(scene == 3)
      document.getElementById("lose").style.display="block";
  }

  //Constants
  var delay = 300;
  var sceneLoading = 0;
  var sceneFight = 1;
  var sceneWin = 2;
  var sceneLose = 3;

  //Game Data
  var gameId; 
  var playerId;
  var k = 0;//Kkomamon
  var p = 1;//Player

  var kTypeAji = 0;
  var kTypeMusawa = 1;
  var kTypeOrbital = 2;
  var kTypeYongyong = 3;
  var kTypePinkmoonaw = 4;

  var kNames = new Array("aji","musawa","orbital","yongyong","pinkmoonaw");
  var kMaxHealths = new Array(100,120,130,140,200);
  var kAttacks = new Array(5,10,15,20,50);
  var pPunch = new Array(30,10,10,10,10);
  var pFire = new Array(10,30,20,20,20);
  var pKiss = new Array(40,40,40,40,40);

  //Variables
  var kHealth;
  var kType;

  var pHealth;
  var pLevel;
  var pXP;
  var pName;

  var turnProgress;
    
  //Constants
  var HEALTH_ITEM_ID = 6;
  var XP_ITEM_ID = 7;  

  function initialize()
  {
      
    //Get PlayerID and GameID from URL
    var params = parseURLParams(document.URL);
    gameId = parseInt(params.gameid);
    playerId = parseInt(params.playerid);
      
    //Get Stuff from Server
    kType = kTypeAji;
    kHealth = kMaxHealths[kType];

    pHealth = parseInt(getItemCountForPlayer(gameId, playerId, HEALTH_ITEM_ID));
      //alert(pHealth);
    //pHealth = 100;
    pLevel = 1;
    pXP = getItemCountForPlayer(gameId, playerId, XP_ITEM_ID);
      //alert(pXP);
    //pXP = 100;

    pName = "Phildo";

    turnProgress = -1;
    //End Server Get

    displayHealth(0); 
    displayHealth(1); 
    
    //Set up the images
    document.getElementById("kkomamon").style.backgroundImage = "url('images/" + kNames[kType] + ".gif')";
    document.getElementById("player").style.backgroundImage = "url('images/player.gif')";
    document.getElementById("firebuttonimage").src = "images/lockedButton.png";
    document.getElementById("kissbuttonimage").src = "images/lockedButton.png";
    document.getElementById("punchbuttonimage").src = "images/punchButton.png";
    if(pLevel > 0)
      document.getElementById("firebuttonimage").src = "images/fireButton.png";
    if(pLevel > 1)
      document.getElementById("kissbuttonimage").src = "images/kissButton.png";
  }

  function displayHealth(fighter)
  {
    if(fighter == k)
    {
      document.getElementById("khealth").style.width = ((kHealth/kMaxHealths[kType])*146)+"px";
      document.getElementById("kname").innerHTML = kNames[kType]+" ("+kHealth+"/"+kMaxHealths[kType]+")";
    }
    else
    {
      document.getElementById("phealth").style.width = ((pHealth/100)*146)+"px";
      //document.getElementById("pname").innerHTML = pName+" ("+pHealth+"/100)"; // <-- SHOULD BE THIS
      document.getElementById("bogusdiv").innerHTML = pName+" ("+pHealth+"/100)"; //BUT BECAUSE CSS SUCKS, IS THIS
    }
  }

  function action(attack, state)
  {
    if(attack > pLevel || turnProgress > state) return;

    document.getElementById("palert").innerHTML = "";
    document.getElementById("palert").style.backgroundImage = "";
    document.getElementById("kalert").innerHTML = "";
    document.getElementById("kalert").style.backgroundImage = "";

    turnProgress = state+1;

    if(state == 0)
    {
      //You Attack
      if(Math.random() > 0.3)
      {
        //Hit
        document.getElementById("kalert").style.backgroundImage = "url('images/hit.png')";

        if(attack == 0)
          kHealth-=pPunch[kType]+(pXP/200)*pPunch[kType];
        if(attack == 1)
          kHealth-=pFire[kType]+(pXP/200)*pFire[kType];
        if(attack == 2)
          kHealth-=pKiss[kType]+(pXP/200)*pKiss[kType];
        kHealth = Math.round(kHealth);

        if(kHealth < 0) kHealth = 0;
        displayHealth(k);
        if(kHealth == 0) { setTimeout(function(){kill(k)}, delay); return; }
      }
      else
      {
        //Miss
        document.getElementById("kalert").style.backgroundImage = "url('images/miss.png')";
      }
      setTimeout(function(){action(attack, state+1)}, delay);
    }

    if(state == 1)
    {
      //They Attack
      if(Math.random() > 0.3)
      {
        //Hit
        document.getElementById("palert").style.backgroundImage = "url('images/hit.png')";
        pHealth-=kAttacks[kType];
        pHealth = Math.round(pHealth);
  
        if(pHealth < 0) pHealth = 0;
        displayHealth(p);
        if(pHealth == 0) { setTimeout(function(){kill(p)}, delay); return; }
      }
      else
      {
        //Miss
        document.getElementById("palert").style.backgroundImage = "url('images/miss.png')";
      }
      setTimeout(function(){action(attack, state+1)}, delay);
    }

    if(state == 2)
    {
      turnProgress = -1;
    }

    // update health and xp in ARIS
    setItemCountForPlayer(gameId, playerId, HEALTH_ITEM_ID, pHealth);
    setItemCountForPlayer(gameId, playerId, XP_ITEM_ID, pXP);

  }

  function kill(fighter)
  {

    if(fighter == k) {
      setScene(sceneWin);
      pXP = pXP + 10; 
    }
    else
      setScene(sceneLose);

    // update health and xp in ARIS
    setItemCountForPlayer(gameId, playerId, HEALTH_ITEM_ID, pHealth);
    setItemCountForPlayer(gameId, playerId, XP_ITEM_ID, pXP);
   
  }
    
    
    
   
</script>
<style>
div
{
  /*
  border-style:solid; 
  border-width:1px;
  */
  padding:0px;
  color:white;
  font-family:Noteworthy;
    font-weight:Bold;
}

.scene
{
  width:100%;
  height:100%;
  display:none;
}

.HUD
{
  margin:10px;
  width:300px;
  height:138px;
  position:relative;
}

.button
{
  float:left; 
  margin-left:10px; 
  margin-top:10px; 
  width:86px; 
  height:80px;
  border-style:solid; 
  border-width:1px;
}

.info
{
  position:absolute;
}

.name
{
  height:25px;
}

.healthbar
{
  border-style:solid;
  border-width:1px;
  border-color:#FFFFFF;
  width:150px;
}

.health
{
  margin:2px;
  height:10px;
  background-color:#00FF00;
}

.fighter
{
  position:absolute;
  height:180px;
  width:160px;
}

.alert
{
  position:absolute;
  height:75px;
  width:150px;
  top:54px;
  left:5px;
}
</style>
</head>
<body onLoad="loadMe()" style="margin:0px; padding:0px;">
<div id="fightScreen" style="position:relative; margin:0px; width:320px; height:416px;">

<div id="loading" class="scene" style="background-color:#000000; display:block;">
  <div style="color:#FFFFFF; position:absolute; top:198px; left:130px; height:20px; width:60px;">
  loading...
  </div>
</div><!-- loading -->

<div style="background-image:url('images/background6.jpg');" id="fight" class="scene">

  <div id="kkomamonHUD" class="HUD">
    <div id="kinfo" class="info" style="left:10px; top:10px;">
      <div id="khealthbar" class="healthbar">
        <div id="khealth" class="health">
        </div>
      </div>
      <div id="kname" class="name">
        Kkomamon
      </div>
    </div>
    <div id="kkomamon" class="fighter" style="left:140px; top:0px;">
      <div id="kalert" class="alert">
      </div>
    </div>
  </div>

  <div id="playerHUD" class="HUD">
    <div id="pinfo" class="info" style="left:140px; top:89px;">
      <div id="pname" class="name" style="position:relative;">
        <div id="bogusdiv" style="position:absolute; bottom:0px; right:0px;">
          You
        </div>
      </div>
      <div id="phealthbar" class="healthbar">
        <div id="phealth" class="health">
        </div>
      </div>
    </div>
    <div id="player" class="fighter" style="left:0px; top:-42px;">
      <div id="palert" class="alert">
      </div>
    </div>
  </div>

  <div id="actions" style="margin:10px; width:300px; height:100px;">
    <div id="punch" class="button" onClick="action(0, 0)">
      <img id="punchbuttonimage" src="" />
    </div>
    <div id="fire" class="button" onClick="action(1, 0)">
      <img id="firebuttonimage" src="" />
    </div>
    <div id="kiss" class="button" onClick="action(2, 0)">
      <img id="kissbuttonimage" src="" />
    </div>
  </div>

</div><!-- fight -->

<div id="win" class="scene" style="background-color:#000000;">
  <div style="color:#FFFFFF; position:absolute; top:198px; left:130px; height:20px; width:60px;">
  win
  </div>
</div><!-- win -->

<div id="lose" class="scene" style="background-color:#000000;">
  <div style="color:#FFFFFF; position:absolute; top:198px; left:130px; height:20px; width:60px;">
  lose
  </div>
</div><!-- lose -->

</div><!-- body -->
</body>
</html>
